
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="#3f51b5">
  <script src="_static/javascripts/modernizr.js"></script>
  
  
  
    <title>2. Device ID Bible &#8212; Amino.py Cookbook 1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/material.css" />
    <link rel="stylesheet" type="text/css" href="_static/twemoji.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="https://twemoji.maxcdn.com/v/latest/twemoji.min.js"></script>
    <script src="_static/twemoji.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="3. Slimekoi &amp; Friends mirror" href="s%26f.html" />
    <link rel="prev" title="1. Session ID Bible" href="sid.html" />
  
   

  </head>
  <body dir=ltr
        data-md-color-primary=blue-grey data-md-color-accent=blue>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#did" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="index.html" title="Amino.py Cookbook 1.0 documentation"
           class="md-header-nav__button md-logo">
          
            &nbsp;
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">Amino.py Cookbook 1.0 documentation</span>
          <span class="md-header-nav__topic"> 2. Device ID Bible </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="search.html" method="GET" name="search">
      <input type="text" class="md-search__input" name="q" placeholder="Search"
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
      
  
  <script src="_static/javascripts/version_dropdown.js"></script>
  <script>
    var json_loc = ""versions.json"",
        target_loc = "../",
        text = "Versions";
    $( document ).ready( add_version_dropdown(json_loc, target_loc, text));
  </script>
  

    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
          <li class="md-tabs__item"><a href="index.html" class="md-tabs__link">Amino.py Cookbook 1.0 documentation</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="index.html" title="Amino.py Cookbook 1.0 documentation" class="md-nav__button md-logo">
      
        <img src="_static/" alt=" logo" width="48" height="48">
      
    </a>
    <a href="index.html"
       title="Amino.py Cookbook 1.0 documentation">Amino.py Cookbook 1.0 documentation</a>
  </label>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#did--page-root" class="md-nav__link">2. Device ID Bible</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#info" class="md-nav__link">2.1. Info</a>
        </li>
        <li class="md-nav__item"><a href="#generating" class="md-nav__link">2.2. Generating</a>
        </li>
        <li class="md-nav__item"><a href="#examples" class="md-nav__link">2.3. Examples</a>
        </li>
        <li class="md-nav__item"><a href="#didssec" class="md-nav__link">2.4. Didssec</a>
        </li>
        <li class="md-nav__item"><a href="#safety" class="md-nav__link">2.5. Safety</a>
        </li>
        <li class="md-nav__item"><a href="#old-device-ids" class="md-nav__link">2.6. Old Device IDs</a>
        </li>
        <li class="md-nav__item"><a href="#replicating" class="md-nav__link">2.7. Replicating</a>
        </li>
        <li class="md-nav__item"><a href="#notes" class="md-nav__link">2.8. Notes</a>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="_sources/did.rst.txt">Show Source</a> </li>

<li id="searchbox" class="md-nav__item"></li>

  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  <section id="device-id-bible">
<h1 id="did--page-root"><span class="section-number">2. </span>Device ID Bible<a class="headerlink" href="#did--page-root" title="Permalink to this headline">üìé</a></h1>
<p><sub>I blatantly copy pasted this from okok#7711, he wrote all of this.</sub></p>
<p><a class="reference external" href="https://cdn.discordapp.com/attachments/844596672574652416/853623881180774410/Device_ID_Generation.docx">Download to original</a></p>
<section id="info">
<h2 id="info"><span class="section-number">2.1. </span>Info<a class="headerlink" href="#info" title="Permalink to this headline">üìé</a></h2>
<p>The Device ID is generated in the Amino App, client-sided, when there is no file called ‚Äúdid‚Äù in the data path of the app (/data/data/com.narvii.amino.master/files). It is 82 characters long and valid IDs always start with 01 (which is the version of the Device ID).</p>
<p>The Device ID consists of 2 SHA1 hashes.
The Device ID is a unique identifier for the device using the app, it is used to verify the validity of a request by checking if it was made from a real device.</p>
</section>
<section id="generating">
<h2 id="generating"><span class="section-number">2.2. </span>Generating<a class="headerlink" href="#generating" title="Permalink to this headline">üìé</a></h2>
<p>The Device ID is generated in multiple steps. Those include:  <strong>deviceIdHw(), deviceId1(), deviceId2().</strong></p>
<div class="line-block">
<div class="line">The deviceId1 is the Advertising Client‚Äôs ID and the deviceId2 is the device‚Äôs android_id.</div>
<div class="line">The deviceIdHw is a compilation of multiple hardware based things, e.g. CPU architecture.</div>
<div class="line"><br/></div>
<div class="line">After generating these 3 IDs they are appended into a string which is then hashed with the SHA1 algorithm.</div>
<div class="line">The hash hhexdigest is then used in the JNI c function of the NativeHelper library (libnh.so).</div>
</div>
<p>The NativeHelper takes the DeviceID version (didsver), appends the hash digest and adds an SHA1 hash at the end.
The key for hashing is generated from R.string.didssec (for further information see [hyperlink to didsec].).</p>
</section>
<section id="examples">
<h2 id="examples"><span class="section-number">2.3. </span>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">üìé</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">0105</span><span class="n">CDF1B4F07638E5B9791312F71B7A6CDE949BB0E2CBA53BAF84F9F80005861B0B809307638DB524</span> <span class="p">(</span><span class="ow">not</span> <span class="n">working</span><span class="p">)</span>
<span class="mi">01</span><span class="n">F4040DA31F278AFBB838FC6C2BCA7D193C77313B5F26375EBB2367CA168E18399E48B6B34AEA4001</span> <span class="p">(</span><span class="n">working</span><span class="p">)</span>
<span class="n">FF0105CDF1B4F07638E5B9791312F71B7A6CDE949BB0</span> <span class="p">(</span><span class="n">generated</span> <span class="n">by</span> <span class="n">exception</span> <span class="n">handling</span> <span class="n">of</span> <span class="n">the</span> <span class="n">application</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="didssec">
<h2 id="didssec"><span class="section-number">2.4. </span>Didssec<a class="headerlink" href="#didssec" title="Permalink to this headline">üìé</a></h2>
<p>Didssec is a 32 character long hexadecimal string. The didssec is hardcoded in the strings.xml file. Didssec itself is used for generating the final key for signing the DeviceID. If the app has been modified, the generation will change and a wrong key will be generated which leads to wrong DeviceIDs being generated. Didssec does not change and a constant value is used.</p>
<p>The didssec is stored in /res/values/strings.xml.</p>
<figure class="align-default">
<img alt="_images/fridacalls.bmp" src="_images/fridacalls.bmp"/>
</figure>
</section>
<section id="safety">
<h2 id="safety"><span class="section-number">2.5. </span>Safety<a class="headerlink" href="#safety" title="Permalink to this headline">üìé</a></h2>
<p>As a safety mechanism, Amino changes didssec along the major updates so that when it is found, that doesn‚Äôt matter anymore. Along with that, when trying to install a dumped APK, Amino errors, stating that ‚Äúimportant libraries are missing‚Äù.</p>
<p>Also, the generation changes if Amino should detect a change in its certs. This can happen when the Amino App has been re-compiled or modified. The change of the generation makes it generate invalid DeviceIDs as seen in the Examples section. If this happens, you‚Äôre unable to send requests.</p>
</section>
<section id="old-device-ids">
<h2 id="old-device-ids"><span class="section-number">2.6. </span>Old Device IDs<a class="headerlink" href="#old-device-ids" title="Permalink to this headline">üìé</a></h2>
<p>Device IDs generated in old versions of the app do not work anymore due to the change of the didssec. In older versions of the App, Amino also didn‚Äôt store the ID in a file and rather generated one on start-up each time. This has performance issues.</p>
</section>
<section id="replicating">
<h2 id="replicating"><span class="section-number">2.7. </span>Replicating<a class="headerlink" href="#replicating" title="Permalink to this headline">üìé</a></h2>
<p>To replicate Amino‚Äôs device ID generation, the key is needed because this is essentially what is checked.</p>
<p>Like a signature. Amino cannot check whether the Values of the SHA1 hash are correct since the hash is a one-way function. This makes it easier to reverse engineer since one only has to find the algorithm used to generate the ID and the key.</p>
<p>The device ID generation is however made more difficult by putting the final functions in Java‚Äôs JNI to make it harder to decompile since decompiling results in unreadable code.</p>
<p>Due to the fact, that Amino changes the key when a change in software is detected, replication is further made difficult as you cannot print the value to logcat or modify the app so that it shows the value.</p>
<p>Instead, the application has to be hooked by a tool like ‚ÄúFrida‚Äù which allows hooking to Android Processes and allows the use of instances of functions in the application. Which could be used as another way to print out the value by hooking to the ‚ÄúDeviceIDService‚Äù Class which contains the functions used to generate the Device IDs.</p>
<p>After that key is grabbed the replication is as simple as hashing random values and appending 01 to it.
Frida can also be used here to use function hooks and logging of the buffers for each argument and return value. This is the easiest way to do it as Frida does everything for you, apart from coding the hooks.</p>
</section>
<section id="notes">
<h2 id="notes"><span class="section-number">2.8. </span>Notes<a class="headerlink" href="#notes" title="Permalink to this headline">üìé</a></h2>
<ul class="simple">
<li><p>The NativeHelper C Function does NOT use an HMAC function for generating the Device IDs and instead uses a normal SHA function and appending the key to the other part of the hash</p></li>
<li><p>The Device ID length is NOT checked server side; it can theoretically be longer or shorter than 82 characters</p></li>
<li><p>The Device ID is mandatory for EVERY request made by the App</p></li>
<li><p>The Web version does not use Device IDs</p></li>
<li><p>The Device ID is partially used for identifying devices for rate limiting when the IP is not used</p></li>
<li><p>The Device ID MUST be hexadecimal characters only, anything other than that WILL result in an error</p></li>
</ul>
</section>
</section>


          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
            <a href="sid.html" title="1. Session ID Bible"
               class="md-flex md-footer-nav__link md-footer-nav__link--prev"
               rel="prev">
              <div class="md-flex__cell md-flex__cell--shrink">
                <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
              </div>
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                <span class="md-flex__ellipsis">
                  <span
                      class="md-footer-nav__direction"> Previous </span> <span class="section-number">1. </span>Session ID Bible </span>
              </div>
            </a>
          
          
            <a href="s%26f.html" title="3. Slimekoi &amp; Friends mirror"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> Next </span> <span class="section-number">3. </span>Slimekoi &amp; Friends mirror </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
          <div class="md-footer-copyright__highlight">
              &#169; Copyright 2021, Mae&#39;s of the Mae&#39;s.
              
          </div>
            Created using
            <a href="http://www.sphinx-doc.org/">Sphinx</a> 4.0.2.
             and
            <a href="https://github.com/bashtage/sphinx-material/">Material for
              Sphinx</a>
        </div>
      </div>
    </div>
  </footer>
  <script src="_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>